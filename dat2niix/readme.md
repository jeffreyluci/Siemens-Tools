# dat2niix

**dat2niix** - A function that generates multi-echo NIfTI files from raw image
           data saved by WashU's NORDIC functor from the CMRR BOLD EPI.

# Usage:
`dat2niix(dicomDirectory, datDirectory, niftiDirectory)`, or optionally,
  `dat2niix(dicomDirectory, datDirectory, niftiDirectory, options)`

**dicomDirectory**: The full path to a directory that contains the DICOM of
                the first echo. If magnitude and phase data are saved,
                each must be saved in individual and separate directories.

**datDirectory**: The full path to a directory of all the raw image (*.dat)
              files generated by the NORDIC functor. These dat files need
              not be separated into different directories for each series
              or for magnitude & phase data. Everything can exist in one
              location, which is how they are saved on the scanner.

**niftiDirectory**: The full path to the directory that will contain the new
                NIfTI files. It is recomended that this folder be empty to
                avoid confusion, but that is not required.

**Options**:

`Verbose = true/(false)` - verbose output to the command line

`highPrecision = true/(false)` - TE recorded in headers with 
                         microsecond precision when set to true, otherwise
                         the TE is recorded with more common tenth of a
                         millisecond precision

`reportTime = true/(false)` - report the total time spent processing the job

 # Discussion:
 
 This function works in conjunction with both the CMRR multiband BOLD EPI 
 sequence and the WashU NORDIC recon functor to produce multi-echo, 
 compressed NIfTIs assembled from the raw image data saved on the scanner
 and header information gathered from both the DICOM of the first echo and
 the NIfTI generated by dcm2niix.

 This solution is meant to avoid resource spikes on the scanner host due
 to what is suspected to be lack of full support of multi-echo images from
 the CMRR BOLD EPI sequence. The NORDIC functor writes only the first echo
 to the host's database and routes the raw images data to a temporary
 location on the scanner's local drive. The raw images do not have any
 metadata associated with them, so dcm2niix is used to generate the first
 echo's header from the DICOM. This function uses the DICOM and the NIfTI
 from dcm2niix to assemble NIfTIs of all echos, one file per echo. 

 The multi-echo NIfTI headers contain the correct TE for their respecitve
 data and the slice timing parameters for all bu the first echo have their
 respective TEs added to them. It is possible to force maximum precision
 recording of the TEs with the highPrecision logical argument.

 Two dependencies exist for this function. The package dcm2niix is
 maintained and distributed at [Chris Rorden's GitHub.](https://github.com/rordenlab/dcm2niix)
 The M-file parseMrProt.m is maintained and distributed at [Jeff Luci's GitHub.](https://github.com/jeffreyluci/Siemens-Tools/tree/main/parseMrProt)
 All software called by or otherwise used by this M-file is subject to the
 license and citation requirements described on their GitHub pages.

 The NORDIC reconstruction functor (pipeline) is available at [The Siemens Teamplay C<sup>2</sup>P Exchange.](https://webclient.us.api.teamplay.siemens-healthineers.com/c2p)

 # Acknowledgements
 Cihat Eldeniz provided invaluable tips and advice on proper implementation of NORDIC, troubleshooting issues, and editing this text.

# Version History
20240201:  Initial Release.
20240202:  Added timed option and numerous comment improvements.
